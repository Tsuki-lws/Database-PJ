# LLM评测平台数据库设计文档

## 1. 系统概述

LLM评测平台是一个专门用于评估大型语言模型(LLM)性能的系统，通过标准化的问题集和答案集，对不同的LLM模型进行评测和比较，评估其在各种场景下的表现能力。

## 2. 数据库设计目标

1. 支持从各平台抓取原始问答数据
2. 建立标准化的问答对体系
3. 支持客观题和主观题的评分
4. 追踪问题、答案和评测数据的版本历史
5. 支持众包和专家审核流程
6. 提供灵活的评测机制，包括自动评测和人工评测

## 3. 数据库架构概览

数据库设计分为以下几个主要模块：

1. **原始数据模块**：存储从外部平台抓取的原始问题和回答
2. **标准化数据模块**：包含标准问题、标准答案和关键评分点
3. **分类和标签模块**：问题的分类和标签体系
4. **用户和权限模块**：系统用户管理
5. **众包和审核模块**：支持众包任务和审核流程
6. **模型和评测模块**：LLM模型信息和评测结果记录
7. **数据集模块**：数据集版本和构成管理

## 4. 实体关系说明

### 4.1 原始数据实体

#### raw_questions (原始问题表)
- 存储从问答社区收集的原始问题
- 关键字段：question_id, question_title, question_body, source

#### raw_answers (原始回答表)
- 存储原始问题的回答
- 与raw_questions是一对多关系
- 关键字段：answer_id, question_id, answer_body, upvotes, is_accepted

### 4.2 标准化数据实体

#### standard_questions (标准问题表)
- 经过标准化处理的问题
- 支持问题类型：单选题、多选题、简单事实、主观题
- 支持难度分级：简单、中等、困难
- 关键字段：standard_question_id, question, question_type, difficulty, version

#### standard_answers (标准答案表)
- 标准问题的参考答案
- 可以来源于原始答案、众包答案或专家答案
- 关键字段：standard_answer_id, standard_question_id, answer, is_final, version

#### answer_key_points (标准答案关键点表)
- 主观题的评分关键点
- 每个关键点有权重和类型(必须、加分、减分)
- 关键字段：key_point_id, standard_answer_id, point_text, point_weight, point_type

#### objective_question_options (客观题选项表)
- 客观题(单选、多选)的选项
- 记录选项文本、代码和是否正确
- 关键字段：option_id, standard_question_id, option_text, option_code, is_correct

### 4.3 版本历史实体

- **standard_question_versions**: 标准问题历史版本
- **standard_answer_versions**: 标准答案历史版本
- **key_point_versions**: 关键点历史版本
- **option_versions**: 选项历史版本

这些表记录了每次修改的历史，包括修改内容、修改人和修改原因。

### 4.4 分类和标签

#### question_categories (问题分类表)
- 分层的问题分类体系
- 通过parent_id形成树形结构

#### tags (标签表)
- 问题标签
- 与standard_questions是多对多关系，通过standard_question_tags表关联

### 4.5 用户和权限

#### users (用户表)
- 系统用户信息
- 支持多种用户类型：管理员、普通用户、专家、审核员

### 4.6 众包和审核

#### crowdsourcing_tasks (众包任务表)
- 众包任务管理
- 任务类型：答案收集、答案审核、答案评分

#### crowdsourced_answers (众包候选答案表)
- 众包收集的答案
- 包含质量评分和审核状态

#### expert_answers (专家回答表)
- 专家提供的高质量答案
- 包含专业级别和验证信息

#### answer_ratings (答案评分表)
- 对众包答案的评分记录
- 支持多维度评分标准

#### answer_comparisons (答案比较表)
- 两两比较不同答案的优劣
- 记录比较结果和理由

### 4.7 模型和评测

#### llm_models (LLM模型表)
- LLM模型信息
- 包含名称、版本、提供商等信息

#### evaluation_batches (评测批次表)
- 模型评测批次管理
- 支持多种评测方法：人工、自动、裁判模型

#### llm_answers (LLM回答表)
- 模型生成的回答
- 记录生成参数和性能指标

#### evaluations (评测结果表)
- 模型回答的评测结果
- 包含综合评分和关键点评估

#### evaluation_key_points (评测关键点详情表)
- 每个关键点的评测结果
- 状态：未覆盖、部分覆盖、完全覆盖

### 4.8 数据集管理

#### dataset_versions (数据集版本表)
- 数据集版本管理
- 记录发布状态和问题数量

#### dataset_question_mapping (数据集问题映射表)
- 数据集与问题的多对多关系
- 定义每个数据集包含的标准问题

## 5. 关键查询场景

1. **问题检索**：按分类、标签、难度等筛选标准问题
2. **评测报告生成**：汇总模型在特定数据集上的表现
3. **版本比较**：对比问题或答案的不同历史版本
4. **关键点分析**：分析模型答案覆盖关键点的情况
5. **众包任务分配**：为用户分配适合的众包任务

## 6. 存储过程

系统实现了多个存储过程来管理数据版本：

1. **update_standard_question**：更新标准问题并保存历史版本
2. **update_standard_answer**：更新标准答案并保存历史版本
3. **update_key_point**：更新关键点并保存历史版本

## 7. 索引优化

为提高查询性能，数据库设计了多个索引：

1. 按删除状态的索引：支持软删除功能
2. 按外键关系的索引：优化连接查询
3. 按常用查询条件的索引：如状态、类型、分类等
4. 按版本查询的索引：优化历史版本查询

## 8. 数据完整性约束

1. **外键约束**：保证数据关系的完整性
2. **唯一约束**：防止数据重复
3. **默认值**：为关键字段设置合理的默认值
4. **软删除**：使用deleted_at字段标记删除，不物理删除数据

## 9. 时序考虑

所有主要表都包含以下时间字段：

1. **created_at**：记录创建时间
2. **updated_at**：记录更新时间，自动更新
3. **deleted_at**：软删除时间戳

## 10. 版本管理设计

数据库采用了严格的版本管理机制：

1. 主表记录当前版本号(version字段)
2. 历史版本表记录所有历史版本内容
3. 更新操作通过存储过程确保版本记录的完整性

## 11. 安全性考虑

1. **用户认证**：通过users表存储用户凭证
2. **操作审计**：记录所有内容变更的操作者
3. **权限控制**：用户类型决定可执行操作范围

## 附录：表关系摘要

- raw_questions 1:N raw_answers
- standard_questions 1:N objective_question_options
- standard_questions 1:N standard_answers
- standard_answers 1:N answer_key_points
- standard_questions N:M tags (通过standard_question_tags)
- standard_questions N:M dataset_versions (通过dataset_question_mapping)
- standard_questions 1:N llm_answers
- llm_answers 1:N evaluations
- evaluations 1:N evaluation_key_points
